{% extends "layouts/base.html" %}
{% block head %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    let calendarEl = document.getElementById('calendar');
    const categoryId = parseInt(document.querySelector("#categoryId").value)
    console.log(categoryId, typeof(categoryId))
    let calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      height: 600,
      selectable: true,
      "allDay": event.is_all_day,
      headerToolbar: {
        left: 'prev,next',
        center: 'title',
        right: 'today'
      },
      eventSources: [{ url: `/events/category/${parseInt(categoryId)}/all_events/`, color: '#C7B7A3' }],
      eventClick: function (info) {
        let startDateTime = formatDate(info.event.startStr);
        let endDateTime = formatDate(info.event.endStr);
        let textContent = `<div style="border: 2px solid #ccc; border-radius: 5px; padding: 10px; margin: 0 20px">
  <div style="display: flex; justify-center: center;">
    <div style="text-align: left;">
      <p style="text-indent: 0; margin: 10px 0; line-height: 1.5;">開始: ${startDateTime}</p>
      <p style="text-indent: 0; margin: 10px 0; line-height: 1.5;">結束: ${endDateTime}</p>
      <p style="text-indent: 0; margin: 10px 0; line-height: 1.5;">活動資訊: ${info.event.extendedProps.description}</p>
    </div>
  </div>
</div>`;
        Swal.fire({
          icon: info.event.allDay,
          title: info.event.title,
          html: textContent,
          confirmButtonText: "OK",
          allowHtml: true
        });
      },
    });
    calendar.render();
  });

  function formatDate(dateTimeStr) {
    const none = "沒有設定"
    if (!dateTimeStr) return none;

    const dateTime = new Date(dateTimeStr);
    const year = dateTime.getFullYear();
    const month = String(dateTime.getMonth() + 1).padStart(2, '0');
    const day = String(dateTime.getDate()).padStart(2, '0');
    const hours = String(dateTime.getHours()).padStart(2, '0');
    const minutes = String(dateTime.getMinutes()).padStart(2, '0');

    return `${year}/${month}/${day} ${hours}:${minutes}`;
  }
</script>

{% endblock %}
{% block content %}
<div class="relative">
  <div class="absolute top-0 right-0 flex justify-end mr-10">
    <a href="{% url 'events:list' category.id %}"
        class="px-4 py-3 mt-5 text-white bg-orange-500 rounded hover:bg-orange-600">活動列表</a>      
  </div>
  <div class="flex items-center justify-center my-8">
    <input type="text"  id="categoryId" value="{{category.id}}" hidden>
    <div id="calendar" class="w-full p-4 sm:w-2/3 md:w-2/3 lg:w-2/3 xl:w-2/3">
    </div>
  </div>
</div>
{% endblock %}