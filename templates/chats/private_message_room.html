{% extends 'boards/base.html' %}
{% load static %}

{% block header %}
<link rel="stylesheet" href="{% static 'styles/friends.css' %}">
{% endblock %}

{% block content %}




<div class="flex flex-col items-center justify-center w-full h-full">
	<div class="flex sticky top-0 w-full bg-white items-center justify-between px-4 py-2 font-normal text-black border-b-1">
		<div class="flex items-center">
			<a href="{% url 'friends:friend_list' %}" class="material-symbols-outlined">arrow_back</a>
			<div class="w-12 aspect-square rounded-full mx-2">
				{% if receiver.user_img %}
					<img src="{{ receiver.user_img.url }}" alt="" class="block w-full h-full object-cover">
				{% else %}	
					<img src="/static/image/cathead.png" alt="Profile Picture" class="block w-full h-full object-cover">
				{% endif %}
			</div>
			<div class="">
				<h2 class="text-3xl self-center">{{ receiver.name }}</h2>
			</div>
		</div>
		<div x-data="{ showDropdown: false }">
			<button @click="showDropdown = !showDropdown" class="focus:outline-none">
				<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24"
					stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
						d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" />
				</svg>
			</button>
			<div x-show="showDropdown" @click.away="showDropdown = false"
				class="absolute py-2 bg-white rounded-md shadow-md z-10 right-2">
				<a href="#"
					class="inline-block px-2 py-1 text-sm font-light text-red-600 hover:text-red-800">刪除好友</a>
			</div>
		</div>
	</div>
	<div class="w-full flex-1 overflow-hidden bg-white rounded-md">
		<div id="chat-log" class="flex flex-col w-full p-4">
			{% for message in private_messages %}
				<div class="mt-3 p-4 w-full flex items-start rounded-md bg-white ">
        			{% if message.sender.id == user.id %}
					<div class="pic w-12 aspect-square rounded-full overflow-hidden">
					{% if message.sender.user_img %}
        		    	<img src="{{ message.sender.user_img.url }}" alt="photo" class="block w-full h-full object-cover">
					{% else %}
						<img src="/static/image/cathead.png" alt="頭貼" class="block w-full h-full object-cover">
					{% endif %}
					</div>
					<div class="ml-2 flex-1 break-all">
						<p class="text-xl">{{message.sender}} <span class="text-xs">{{message.created_at|date:"Y-m-d H:i"}}</span></p>
						<p class="w-full">{{message.content}}</p>								
					</div>
        			{% else %}
					<div class="pic w-12 aspect-square rounded-full overflow-hidden">
					{% if message.sender.user_img %}
        				<img src="{{ message.sender.user_img.url }}" alt="photo" class="block w-full h-full object-cover">
					{% else %}
						<img src="/static/image/cathead.png" alt="頭貼" class="block w-full h-full object-cover">
					{% endif %}
					</div>
					<div class="ml-2 flex-1 break-all">
						<p class="text-xl">{{message.sender}} <span class="text-xs">{{message.created_at|date:"Y-m-d H:i"}}</span></p>
						<p class="w-full">{{message.content}}</p>								
					</div>
					{% endif %}
        		</div>
        	{% endfor %}
		</div>
	</div>	
	<div class="flex sticky bottom-0 w-full bg-white p-4 items-center">
		{% if user.user_img %}
		<div class="hidden" id="chat-message-user" data-user-id="{{ user.id }}" data-user-name="{{ user.username }}" data-user-img="{{ user.user_img.url }}"></div>
		{% else %}
		<div class="hidden" id="chat-message-user" data-user-id="{{ user.id }}" data-user-name="{{ user.username }}" data-user-img="/static/image/cathead.png"></div>
		{% endif %}
		<textarea id="chat-message-input" cols="30" rows="2" placeholder="輸入訊息..." class="flex-1 px-2 rounded-md focus:outline-none resize-none"></textarea>
		<button id="chat-message-submit"
			class="bg-[#3397cf] text-white font-light py-2 px-4 rounded-md hover:bg-sky-400 disabled:bg-gray-400" disabled>送出</button>
	</div>
	{{ room_name|json_script:"room-name" }}
</div>

<script src="{% static 'scripts/add_private_message.js' %}"></script>

{% endblock %}